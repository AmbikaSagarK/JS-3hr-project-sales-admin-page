<html>
  <head>
   
  </meta>
  <style>
    .container {
  padding: 16px;
}
    form {
      background-color:orange;
      font-size: 20px;
      color: greenyellow;
      text-align: center;
      
    }
    input{
      font-size: 30px;
      color: yellow;
      width: 1000px;
    }
  </style>

  </head>
  <body>
    <form onsubmit="saveToLocalStorage(event)">  
        <label> Name </label>
        <br>
        <input id="username" type="text" name="visitor_name" required>    
        <br>
        <label> emailId </label>
        <br>
        <input id="email" type="email" name="visitor_email" required>
        <br>
        <label>phone </label>
        <br>
        <input id="phonenumber" type="tel" name="visitor_phone" required>
        <br>
       <button onclick=""> Submit </button>
      <li>
        <button type="Delete">Delete</button>
        <button type="Edit">Edit</button>
      </li>
    </form>
    <ul id="listOfUsers"></ul>
    //<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
      function saveToLocalStoarage(event){
        event.preventDefault();
      const name = event.target.username.value;
      const email = event.target.emailId.value;
      const phonenumber = event.target.phonenumber.value;
    //   localStorage.setItem('name',name);
    //   localStorage.setItem('email',email);
    //    localStorage.setItem('phonenumber',phonenumber);

       const obj = {
        name,
        email,
        phonenumber
       }

       axios.post("https://crudcrud.com/api/7bd568e301f041d7a932adf4cba5a369/bookingappointnment",obj)
       .then((response) =>   {
        showNewUserOnScreen(response.data)
        //console.log(response)
       })
       //if something goes wrong
       .catch((error) =>{
        document.body.innerHTML = document.body.innerHTML + "<h4> Something Went wrong </h4>"
        consolr.log(err)
       })
    //    localStorage.setItem(obj.email.JSON.stringyfy(obj))
    //    showNewUserOnScreen(obj)
      }
      
      window.addEventListener("DOMContentLoaded", () => {
        const date = axios.delete("https://crudcrud.com/api/65e1c4fa6be04cbebaf5f7395dd10b0c/bookingappointnment/648416a3456f2b03e80bc86d")
        .then((response) => {
           // console.log(response);

            for(var i=0; i<response.data.length; i++) {
                showNewUserOnScreen(response.data[i])
            }
         })
         .catch=((error) => {
            console.log(error)
        })        
        console.log(data);
        // const localStorageObj = localStorage;
        // const localStoragekeys = Objects.keys(localStorageObj)

        // for(var i=0; i<localStoragkeys.length; i++){
        //     const key=localStoragekeys[i]
        //     const userDetailsString = localStorageObj[key];
        //     const userDetailsObj = JSON.parse(userDetailsString);
        //     showNewUserOnScreen(userDetailsObj)
        // }
      })
      function showNewUserOnScreen(user){
        document.getElementById('email').value='';
        document.getElementById('username').value='';
        document.getElementById('phonenumber').value='';
        //console.log(localStorage.getItem(user.emailId))
        if(localStorage.getItem(user.email) !==null) {
          removeUserFromScree(user.email)
        }
        const parentNode = document.getElementById('ListOfUsers');
        const ChildHTML = '<li id=$(user._id)> $(user.name) -$(user.email)
                          <button onclick = deleteUser('$(user._id)')> Delete User </button>
                            <button onclick = editUserDetails('$(user._id)','$(user.name)','$(user.phonenumber)','$(user._id)')> Edit User </button>
                            </li>'

      ParentNode.innerHTML = parentNode.innerHTML + childHTML;
      }

      //Edit user
      function editUserDetails(emailId, name, phonenumber, userId) {
      document.getElementById('username').value=name;
      document.getElementById('emailId').value=emailId;
      document.getElementById('phoneNumber').value=phoneNumber;

      deleteUser(userId)    
      }

      //deleteuser

      function deleteUser(userId){
      axios.delete('https://crudcrud.com/api/65e1c4fa6be04cbebaf5f7395dd10b0c/bookingappointnment/$(userId)')
      .then((response)=>{
        removeUserFromScreen(userId)
      })
       .catch((err) => {
        console.log(err);
       })
      }
      function removeUserFromScreen(userId){
        const parentNode = document.getElementbyId('listOfUsers');
        const childNodeToBeDeleted = document.getElementbyId(emailId);
        if(childNodetoBeDeleted){
          parentNode.removeChild(childNodetoBeDeleted)
        }
      }
     
    
    </script>
  </body>
  
</html>